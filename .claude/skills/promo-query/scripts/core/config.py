# -*- coding: utf-8 -*-
"""promo-query 스킬 상수 정의

승진직급 서열, DB 경로, 필터 조건 등 시스템 전체에서 사용하는 상수를 한 곳에서 관리한다.
"""

import os

# ──────────────────────────────────────────────
# 승진직급 서열 (이 시스템의 가장 중요한 상수)
# 승0(본부장급) >> 승1(1급) >> 승2(2급) >> PCEO(Pre-CEO) >> 승3(3급) >> 승4(4급)
# ──────────────────────────────────────────────
RANK_ORDER = ['승0', '승1', '승2', 'PCEO', '승3', '승4']

RANK_ORDER_MAP = {rank: idx + 1 for idx, rank in enumerate(RANK_ORDER)}

RANK_ORDER_SQL = """CASE {col}
  WHEN '승0' THEN 1 WHEN '승1' THEN 2 WHEN '승2' THEN 3
  WHEN 'PCEO' THEN 4 WHEN '승3' THEN 5 WHEN '승4' THEN 6
END"""

def rank_order_sql(col='승진직급'):
    """테이블 별칭이 포함된 컬럼명에 대해 CASE 서열 SQL을 반환한다."""
    return RANK_ORDER_SQL.format(col=col)

# ──────────────────────────────────────────────
# 승진기준년수 (현재 직급 → 최소 직급연차)
# 실제 판별은 build-ibk_HR에서 DB 생성 시 수행 (승진대상여부 컬럼)
# ──────────────────────────────────────────────
PROMOTION_TENURE = {
    '승4': 9.0,
    '승3': 6.0,
    'PCEO': 3.0,
    '승2': 1.0,
    '승1': 0.5,
}

# ──────────────────────────────────────────────
# DB 경로
# ──────────────────────────────────────────────
_VAULT_ROOT = os.environ.get(
    'ZK_PARA_ROOT',
    os.path.abspath(os.path.join(os.path.dirname(__file__), '..', '..', '..', '..', '..'))
)
DB_PATH = os.path.join(_VAULT_ROOT, '3_Resources', 'R-DB', 'ibk_HR.db')

# ──────────────────────────────────────────────
# 필터 조건
# ──────────────────────────────────────────────
BASE_FILTER = "h.인원포함여부 = 1"
TARGET_FILTER = "h.인원포함여부 = 1 AND h.승진대상여부 = 1"

# ──────────────────────────────────────────────
# 소수집단 임계값
# ──────────────────────────────────────────────
MIN_GROUP_SIZE = 5

# ──────────────────────────────────────────────
# 범위(scope) 매핑
# ──────────────────────────────────────────────
SCOPE_COLUMN_MAP = {
    '전행': None,
    '그룹': 'h.그룹',
    '부점': 'h.부점',
    '세분': 'h.세분',
    '본점비교': 'h.본점여부',
}

# ──────────────────────────────────────────────
# 기본값
# ──────────────────────────────────────────────
DEFAULT_LIMIT = 20
DEFAULT_TIMELINE_COUNT = 10
