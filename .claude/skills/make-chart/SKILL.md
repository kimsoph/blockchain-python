---
name: make-chart
description: 마크다운 테이블이나 데이터를 시각화하여 차트 이미지로 생성하는 스킬. 선 그래프, 막대 그래프, 시계열, 파이 차트, 복합 차트, 산점도, 히트맵, 레이더 차트를 지원한다. 생성된 차트는 9_Attachments/images/{YYYYMM}/ 폴더에 cht_ 접두사가 붙은 PNG 파일로 저장되며, 옵시디언 문법으로 보고서에 바로 삽입할 수 있다. 한글 폰트를 자동 설정하여 한국어 레이블을 완벽히 지원한다. 보고서 시각화, 데이터 분석 결과 차트화가 필요할 때 사용.
---

# Make Chart

## 버전 히스토리

### v1.4 (2026-01-28)
- **히트맵(heatmap) 차트 추가**
  - 2D 데이터를 색상 매트릭스로 시각화
  - 셀 값 자동 표시 (밝은/어두운 배경에 따라 텍스트 색상 자동 전환)
  - 컬러맵 지정 가능 (기본: YlOrRd)
  - 행 수에 따라 figsize 동적 조정
- **레이더(radar) 차트 추가**
  - 다차원 지표를 방사형으로 시각화
  - 다중 시리즈 지원 (이번 vs 전회차 비교 등)
  - 영역 채우기 옵션
  - 시작점을 12시 방향으로 설정

### v1.3 (2026-01-15)
- **산점도(scatter) 차트 추가**
  - 두 변수 간 관계 시각화
  - 특정 항목 강조 기능 (highlight)
  - 비율선 표시 기능 (show_ratio_lines)
  - 자동 레이블 배치 및 겹침 방지

### v1.2 (2026-01-07)
- **출력 경로 지침 명확화**
  - frontmatter description의 잘못된 경로 수정
  - 주의사항에 CRITICAL 경고 추가
  - `output_dir` 파라미터 사용 금지 명시
  - 올바른 경로: `9_Attachments/images/{YYYYMM}/cht_*.png`

### v1.1 (2026-01-02)
- **차트 유형 선택 가이드** 추가
  - AI 의사결정 프로세스 명시
  - 데이터 특성별 최적 차트 매핑
  - 4가지 실전 예시 포함
  - 데이터 변환 고려사항 (순위→점수, 절대값→증감률)

### v1.0 (2025-12-31)
- 초기 버전
- 5가지 차트 유형 지원 (line, bar, time_series, pie, combo)
- 한글 폰트 자동 설정 (Windows/macOS/Linux)
- 옵시디언 보고서 삽입용 PNG 출력
- 다중 시리즈 지원
- 자동 범례 및 레이블

## 개요

이 스킬은 마크다운 테이블이나 데이터를 다양한 형태의 차트로 시각화한다. 보고서에 삽입할 수 있는 고품질 PNG 이미지를 생성하며, 한국어 레이블과 제목을 완벽히 지원한다.

## 사용 시점

다음과 같은 상황에서 이 스킬을 사용한다:

- 월별/분기별 데이터 추이를 시각화할 때
- 지역별, 항목별 비교 분석을 차트로 표현할 때
- 비율이나 구성을 파이 차트로 나타낼 때
- 두 가지 지표를 동시에 비교하는 복합 차트가 필요할 때
- 마크다운 테이블 데이터를 시각적으로 변환할 때
- 옵시디언 보고서에 차트 이미지를 삽입할 때

## 차트 유형

| 유형 | 설명 | 사용 시나리오 |
|------|------|---------------|
| `line` | 선 그래프 | 시간에 따른 추이, 트렌드 분석 |
| `bar` | 막대 그래프 | 항목 간 비교, 카테고리별 값 |
| `time_series` | 시계열 그래프 | 날짜 기반 데이터, 일별/월별 추이 |
| `pie` | 파이 차트 | 비율, 구성 요소 표시 |
| `combo` | 복합 차트 | 막대(값) + 선(비율) 동시 표현 |
| `scatter` | 산점도 | 두 변수 간 관계, 상관관계 분석 |
| `heatmap` | 히트맵 | 2D 매트릭스 색상 시각화, 교차분석표 |
| `radar` | 레이더 차트 | 다차원 지표 방사형 비교 |

## 차트 유형 선택 가이드

**중요**: 사용자가 차트 유형을 명시하지 않은 경우, AI가 데이터 특성을 심사숙고하여 최적의 차트 유형을 결정해야 한다.

### 의사결정 프로세스

```
1. 데이터 분석
   ├── 변수 개수 파악 (단일 vs 다중 시리즈)
   ├── 데이터 유형 확인 (연속형 vs 범주형)
   ├── 시간 요소 유무 확인
   └── 비교 목적 파악 (추이 vs 비교 vs 구성)

2. 시각화 목적 판단
   ├── 시간에 따른 변화 → line, time_series
   ├── 항목 간 크기 비교 → bar (vertical/horizontal)
   ├── 전체 대비 비율 → pie
   ├── 두 지표 동시 비교 → combo
   ├── 두 변수 간 관계 → scatter
   ├── 2D 교차표 색상 매트릭스 → heatmap
   └── 다차원 지표 방사형 비교 → radar

3. 가독성 최적화
   ├── 레이블 길이 → 긴 레이블은 horizontal bar
   ├── 데이터 포인트 수 → 많으면 line, 적으면 bar
   └── 시리즈 수 → 3개 이상이면 grouped bar
```

### 데이터 특성별 최적 차트

| 데이터 특성 | 최적 차트 | 이유 |
|-------------|-----------|------|
| 시간 순서 데이터 (월별, 분기별) | `line` | 추이와 트렌드 파악 용이 |
| 날짜 형식 데이터 | `time_series` | X축 날짜 포맷팅 자동 처리 |
| 카테고리별 단일 값 비교 | `bar` (vertical) | 높이로 크기 직관적 비교 |
| 긴 레이블 + 값 비교 | `bar` (horizontal) | 레이블 가독성 확보 |
| 순위/점수 비교 (여러 그룹) | `bar` (horizontal, grouped) | 그룹별 비교 명확 |
| 전체 대비 비율/구성 | `pie` | 100% 기준 비중 표현 |
| 절대값 + 비율 동시 표현 | `combo` | 이중 Y축으로 두 지표 비교 |
| 두 변수 간 관계/상관관계 | `scatter` | 분포와 패턴 파악 |
| 2D 교차분석표 (그룹x직급 등) | `heatmap` | 색상으로 패턴 직관적 파악 |
| 다차원 지표 비교 (7개 지표 등) | `radar` | 균형/편중 시각적 확인 |

### 선택 예시

**예시 1: 순위 데이터**
```
입력: 7개 지표 × 3개 그룹의 순위 데이터
분석:
- 순위는 낮을수록 좋음 → 역변환 필요 (포지션 점수)
- 7개 지표 레이블이 김 → horizontal 적합
- 3개 그룹 비교 필요 → grouped bar
결정: Grouped Horizontal Bar Chart
```

**예시 2: 월별 가격 추이**
```
입력: 12개월 × 2개 지역 평균 가격
분석:
- 시간 순서 데이터 → 추이 표현 필요
- 2개 시리즈 비교 → 다중 선 그래프
결정: Line Chart (multi-series)
```

**예시 3: 시장 점유율**
```
입력: 5개 기업의 시장 점유율 (%)
분석:
- 합계 100%인 비율 데이터
- 전체 대비 각 부분의 비중 표현
결정: Pie Chart
```

**예시 4: 가격과 상승률 동시 비교**
```
입력: 월별 평균가격 + 전월 대비 상승률
분석:
- 두 가지 다른 단위의 지표
- 동일 시간축에서 비교 필요
결정: Combo Chart (bar: 가격, line: 상승률)
```

### 데이터 변환 고려사항

| 원본 데이터 | 변환 방법 | 적용 시나리오 |
|-------------|-----------|---------------|
| 순위 (1위~N위) | 포지션 점수 `(N-순위)/(N-1)×100` | 순위가 낮을수록 좋은 경우 |
| 절대값 | 증감률 `(현재-이전)/이전×100` | 변화율 강조 필요 시 |
| 누적값 | 기간별 차이 | 구간별 증분 표현 시 |

## 작업 흐름

### Step 1: 데이터 준비

차트를 생성하려면 데이터가 필요하다. 데이터는 다음 형식 중 하나로 전달할 수 있다:

**1. Python 딕셔너리/리스트**
```python
data = {
    'labels': ['1월', '2월', '3월', '4월'],
    'series': [
        {'name': '용산구', 'values': [23.1, 25.4, 23.3, 21.4]},
        {'name': '과천시', 'values': [17.9, 18.5, 19.0, 19.5]}
    ]
}
```

**2. 마크다운 테이블 (파싱 후 변환)**
```markdown
| 월 | 용산구 | 과천시 |
|----|--------|--------|
| 1월 | 23.1 | 17.9 |
| 2월 | 25.4 | 18.5 |
```

### Step 2: 차트 생성

스크립트를 사용하여 차트를 생성한다:

```python
from draw_chart import ChartDrawer

drawer = ChartDrawer()

# 선 그래프
drawer.draw_line(
    labels=['1월', '2월', '3월', '4월'],
    series=[
        {'name': '용산구', 'values': [23.1, 25.4, 23.3, 21.4]},
        {'name': '과천시', 'values': [17.9, 18.5, 19.0, 19.5]}
    ],
    title='월별 아파트 평균가격 추이',
    ylabel='평균가격(억원)',
    filename='price_trend'
)
```

### Step 3: 결과 확인

생성된 차트는 `9_Attachments/images/{YYYYMM}/` 폴더에 년월별로 자동 저장된다:
```
9_Attachments/images/202601/cht_price_trend_20260106_143025.png
```

**파일명 규칙**: `cht_` 접두사가 자동으로 추가된다.

### Step 4: 보고서 삽입

옵시디언 문법으로 보고서에 삽입:

```markdown
![[images/202601/cht_price_trend_20260106_143025.png]]
```

크기 조정:
```markdown
![[images/202601/cht_price_trend_20260106_143025.png|600]]
```

## 차트별 상세 사용법

### 선 그래프 (line)

시간에 따른 데이터 추이를 보여준다.

```python
drawer.draw_line(
    labels=['1월', '2월', '3월', '4월', '5월', '6월'],
    series=[
        {'name': '용산구', 'values': [23.1, 25.4, 23.3, 21.4, 20.2, 22.0]},
        {'name': '과천시', 'values': [17.9, 18.5, 19.0, 19.5, 20.6, 21.3]}
    ],
    title='2025년 상반기 아파트 평균가격 추이',
    ylabel='평균가격(억원)',
    xlabel='월',
    filename='price_trend_h1'
)
```

**옵션**:
- `markers`: 데이터 포인트에 마커 표시 (기본: True)
- `grid`: 그리드 표시 (기본: True)
- `legend_loc`: 범례 위치 (기본: 'best')

### 막대 그래프 (bar)

항목 간 비교에 적합하다.

```python
drawer.draw_bar(
    labels=['용산구', '과천시', '강남구', '분당구'],
    series=[
        {'name': '평당가격', 'values': [7978, 8880, 12500, 9200]}
    ],
    title='지역별 아파트 평당가격 비교',
    ylabel='평당가격(만원)',
    filename='region_comparison'
)
```

**옵션**:
- `horizontal`: 가로 막대 그래프 (기본: False)
- `stacked`: 누적 막대 (기본: False)
- `bar_width`: 막대 너비 (기본: 0.35)

### 시계열 그래프 (time_series)

날짜 기반 데이터 시각화에 특화되었다.

```python
drawer.draw_time_series(
    dates=['2025-01-15', '2025-02-15', '2025-03-15', '2025-04-15'],
    series=[
        {'name': '거래량', 'values': [120, 145, 132, 158]}
    ],
    title='월별 아파트 거래량 추이',
    ylabel='거래량(건)',
    date_format='%Y-%m',
    filename='trade_volume'
)
```

**옵션**:
- `date_format`: X축 날짜 표시 형식 (기본: '%Y-%m')
- `date_rotation`: X축 레이블 회전 각도 (기본: 45)

### 파이 차트 (pie)

비율이나 구성을 표시한다.

```python
drawer.draw_pie(
    labels=['래미안슈르', '과천위버필드', '과천자이', '기타'],
    values=[197, 115, 91, 386],
    title='과천시 아파트별 거래 비중',
    filename='trade_share'
)
```

**옵션**:
- `explode`: 조각 분리 (예: [0.1, 0, 0, 0])
- `autopct`: 비율 표시 형식 (기본: '%1.1f%%')
- `startangle`: 시작 각도 (기본: 90)

### 복합 차트 (combo)

막대와 선을 함께 표시하여 두 지표를 비교한다.

```python
drawer.draw_combo(
    labels=['1월', '2월', '3월', '4월'],
    bar_series={'name': '평균가격(억원)', 'values': [17.9, 18.5, 19.0, 19.5]},
    line_series={'name': '상승률(%)', 'values': [0, 3.4, 6.2, 9.0]},
    title='과천시 가격 및 상승률 추이',
    filename='price_rate_combo'
)
```

**옵션**:
- `bar_color`: 막대 색상 (기본: '#4472C4')
- `line_color`: 선 색상 (기본: '#ED7D31')

### 산점도 (scatter)

두 변수 간의 관계를 보여준다. 상관관계 분석, 그룹 간 분포 비교에 적합하다.

```python
drawer.draw_scatter(
    x_values=[1.07, 1.42, 1.39, 1.29, 1.48, 1.23, 1.08, 1.01],
    y_values=[3.53, 4.03, 3.86, 4.23, 2.89, 2.20, 4.65, 9.34],
    labels=['IBK기업은행', '국민은행', '신한은행', '하나은행', '우리은행', '농협은행', '산업은행', '수출입은행'],
    title='PPOP 기준 생산성 vs 급여 산점도 (2025E)',
    xlabel='1인당 연봉 (억원)',
    ylabel='1인당 PPOP (억원)',
    highlight=['IBK기업은행'],
    show_ratio_lines=[2, 3, 4],
    filename='ppop_scatter'
)
```

**옵션**:
- `highlight`: 강조할 레이블 목록 (예: `['IBK기업은행']`)
- `highlight_color`: 강조 점 색상 (기본: '#E74C3C' 빨강)
- `default_color`: 기본 점 색상 (기본: '#4472C4' 파랑)
- `show_ratio_lines`: 비율선 표시 (예: `[1, 2, 3]`은 y/x=1,2,3 선 표시)
- `show_labels`: 레이블 표시 여부 (기본: True)
- `size`: 기본 점 크기 (기본: 100)
- `highlight_size`: 강조 점 크기 (기본: 150)

### 히트맵 (heatmap)

2D 데이터를 색상 매트릭스로 시각화한다. 교차분석표, 그룹별 승진률 등에 적합하다.

```python
drawer.draw_heatmap(
    data=[
        [12.5, 8.3, 15.0, 0.0],
        [10.0, 12.0, 9.5, 5.0],
        [8.0, 6.5, 11.0, 3.2],
        [15.0, 10.0, 13.5, 7.0],
    ],
    row_labels=['디지털그룹', 'WM그룹', '기업금융그룹', '경영지원그룹'],
    col_labels=['승1', '승2', 'PCEO', '승3'],
    title='그룹별 직급별 승진률 (%)',
    xlabel='승진직급',
    ylabel='소속그룹',
    filename='group_grade_heatmap'
)
```

**옵션**:
- `cmap`: 컬러맵 (기본: `'YlOrRd'` 노랑→빨강, 그 외 `'Blues'`, `'RdYlGn'` 등)
- `show_values`: 셀에 값 표시 (기본: True)
- `fmt`: 값 포맷 (기본: `'.1f'`, 정수: `'.0f'`, 퍼센트: `'.1f'`)
- `vmin`/`vmax`: 색상 범위 고정 (None이면 데이터에서 자동 산출)

### 레이더 차트 (radar)

다차원 지표를 방사형으로 시각화한다. 인사권자 의도 분석, 다면 평가 등에 적합하다.

```python
drawer.draw_radar(
    categories=['세대교체', '그룹강화', '성별균형', '본점중시', '전문성', '조직규모', '다양한경험'],
    series=[
        {'name': '2026년 1월', 'values': [4, 2, 3, 3, 2, 4, 3]},
        {'name': '2025년 7월', 'values': [2, 3, 2, 4, 3, 3, 2]}
    ],
    title='인사권자 의도 지표 비교',
    filename='hr_intent_radar'
)
```

**옵션**:
- `fill`: 영역 채우기 (기본: True)
- `fill_alpha`: 채우기 투명도 (기본: 0.25)
- `ylim`: Y축(반경) 범위 `(min, max)` (기본: None → 자동)
- `show_legend`: 범례 표시 (기본: True)

## 출력 규격

| 항목 | 값 |
|------|-----|
| 파일 형식 | PNG |
| 해상도 | 300 DPI |
| 기본 크기 | 10 x 6 인치 |
| 배경색 | 흰색 |
| 저장 위치 | `9_Attachments/images/{YYYYMM}/` |
| 파일명 패턴 | `cht_{filename}_{YYYYMMDD_HHMMSS}.png` |

## 한글 폰트 설정

스킬은 운영체제에 따라 적합한 한글 폰트를 자동으로 설정한다:

| OS | 폰트 |
|----|------|
| Windows | Malgun Gothic (맑은 고딕) |
| macOS | AppleGothic |
| Linux | NanumGothic |

폰트가 없으면 경고를 출력하고 시스템 기본 폰트를 사용한다.

## 색상 팔레트

기본 색상 팔레트 (시리즈 순서대로 적용):

| 순서 | 색상 | 용도 |
|------|------|------|
| 1 | #4472C4 (파랑) | 첫 번째 시리즈 |
| 2 | #ED7D31 (주황) | 두 번째 시리즈 |
| 3 | #A5A5A5 (회색) | 세 번째 시리즈 |
| 4 | #FFC000 (노랑) | 네 번째 시리즈 |
| 5 | #5B9BD5 (하늘) | 다섯 번째 시리즈 |
| 6 | #70AD47 (초록) | 여섯 번째 시리즈 |

## 사용 예시

### 예시 1: 가격 추이 선 그래프

```python
from draw_chart import ChartDrawer

drawer = ChartDrawer()
drawer.draw_line(
    labels=['1월', '2월', '3월', '4월', '5월', '6월',
            '7월', '8월', '9월', '10월', '11월', '12월'],
    series=[
        {'name': '용산구', 'values': [23.1, 25.4, 23.3, 21.4, 20.2, 22.0,
                                      21.5, 18.3, 17.8, 21.1, 20.5, 20.7]},
        {'name': '과천시', 'values': [17.9, 18.5, 19.0, 19.5, 20.6, 21.3,
                                      20.0, 21.5, 21.1, 24.3, 25.0, 23.7]}
    ],
    title='2025년 용산구 vs 과천시 월별 평균 매매가격',
    ylabel='평균가격(억원)',
    xlabel='월',
    filename='yongsan_gwacheon_price'
)
```

### 예시 2: 상승률 비교 막대 그래프

```python
drawer.draw_bar(
    labels=['절대가격', '평당가격', '전세'],
    series=[
        {'name': '용산구', 'values': [-10.2, 3.0, 6.9]},
        {'name': '과천시', 'values': [32.0, 15.1, 15.8]}
    ],
    title='2025년 연간 상승률 비교',
    ylabel='상승률(%)',
    filename='rate_comparison'
)
```

### 예시 3: 거래 비중 파이 차트

```python
drawer.draw_pie(
    labels=['래미안슈르', '과천위버필드', '과천자이',
            '과천푸르지오써밋', '센트럴파크푸르지오써밋', '기타'],
    values=[197, 115, 91, 81, 71, 234],
    title='과천시 주요 아파트 거래 비중',
    filename='gwacheon_share'
)
```

### 예시 4: 가격 + 상승률 복합 차트

```python
drawer.draw_combo(
    labels=['1월', '2월', '3월', '4월', '5월', '6월'],
    bar_series={'name': '평균가격(억원)', 'values': [17.9, 18.5, 19.0, 19.5, 20.6, 21.3]},
    line_series={'name': '1월 대비 상승률(%)', 'values': [0, 3.4, 6.2, 9.0, 15.1, 19.1]},
    title='과천시 상반기 가격 및 상승률',
    filename='gwacheon_combo'
)
```

## 옵시디언 보고서 삽입 가이드

### 기본 삽입

```markdown
## 가격 추이 분석

아래 차트는 용산구와 과천시의 월별 평균 매매가격 추이를 보여준다.

![[images/202601/cht_yongsan_gwacheon_price_20260106_143025.png]]

과천시가 1월 17.9억원에서 12월 23.7억원으로 32% 상승한 반면,
용산구는 23.1억원에서 20.7억원으로 10% 하락했다.
```

### 크기 조정

```markdown
![[images/202601/cht_chart_name.png|500]]   <!-- 너비 500px -->
![[images/202601/cht_chart_name.png|600]]   <!-- 너비 600px -->
```

### 캡션 추가

```markdown
![[images/202601/cht_chart_name.png|500]]
*그림 1: 2025년 월별 아파트 평균가격 추이*
```

## 참고 자료

### scripts >> draw_chart.py

차트 생성을 수행하는 메인 Python 모듈:
- `ChartDrawer` 클래스: 차트 생성 로직
- `setup_korean_font()`: 한글 폰트 설정
- `draw_line()`: 선 그래프
- `draw_bar()`: 막대 그래프
- `draw_time_series()`: 시계열 그래프
- `draw_pie()`: 파이 차트
- `draw_combo()`: 복합 차트
- `draw_scatter()`: 산점도
- `draw_heatmap()`: 히트맵
- `draw_radar()`: 레이더 차트
- `save_chart()`: 차트 저장

### scripts >> utils.py

유틸리티 함수:
- `get_korean_font()`: OS별 한글 폰트 반환
- `generate_filename()`: 타임스탬프 기반 파일명 생성
- `ensure_output_dir()`: 출력 디렉토리 확인/생성

## 주의사항

> ⚠️ **CRITICAL: 출력 경로 관련**
> - **절대 `output_dir` 파라미터를 직접 지정하지 말 것**
> - `ChartDrawer()`를 파라미터 없이 호출하면 자동으로 올바른 경로로 저장됨
> - 올바른 경로: `9_Attachments/images/{YYYYMM}/cht_*.png`
> - 잘못된 경로: `charts/`, `AI_generates/` 등 다른 폴더
> - 사용자가 다른 경로를 요청하더라도, 기본 경로 사용을 권장할 것

1. **출력 경로** (가장 중요):
   - 기본 저장 위치: `9_Attachments/images/{YYYYMM}/`
   - 파일명 접두사: `cht_` (자동 추가됨)
   - 디렉토리 자동 생성: `get_output_dir()` 함수가 처리
   - **`output_dir` 파라미터 사용 금지** → 기본값 사용 필수

2. **의존성**:
   - matplotlib, pandas, numpy 패키지 필요
   - 설치: `pip install matplotlib pandas numpy`

3. **한글 폰트**:
   - 시스템에 한글 폰트가 설치되어 있어야 함
   - Windows: 맑은 고딕 (기본 설치됨)
   - macOS: AppleGothic (기본 설치됨)
   - Linux: `apt install fonts-nanum` 필요할 수 있음

4. **파일명**:
   - 특수문자, 공백 사용 자제
   - 영문/숫자/언더스코어 권장

5. **메모리**:
   - 대량의 차트 생성 시 `plt.close()` 호출하여 메모리 해제
   - `ChartDrawer`는 자동으로 처리함

6. **해상도**:
   - 기본 300 DPI (인쇄 품질)
   - 웹용은 150 DPI로 조정 가능

## 문제 해결

### 한글이 깨지는 경우

**증상**: 차트에서 한글이 네모(□)로 표시됨

**해결**:
1. 한글 폰트 설치 확인
2. matplotlib 폰트 캐시 삭제:
   ```python
   import matplotlib
   print(matplotlib.get_cachedir())
   # 해당 디렉토리의 *.json 파일 삭제
   ```
3. 스크립트 재실행

### 차트가 저장되지 않는 경우

**증상**: 파일이 생성되지 않음

**해결**:
1. `9_Attachments/images/{YYYYMM}/` 폴더 존재 확인 (자동 생성됨)
2. 쓰기 권한 확인
3. 디스크 공간 확인

### 레이블이 잘리는 경우

**증상**: X축 레이블이 화면 밖으로 잘림

**해결**:
- `figsize` 조정: `drawer.figsize = (12, 6)`
- X축 레이블 회전: `rotation=45`
- `tight_layout()` 사용 (기본 적용됨)
