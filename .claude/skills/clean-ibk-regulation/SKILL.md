# clean-ibk-regulation

IBK 기업은행 내규 문서를 클리닝하는 스킬

**버전**: 1.3.0

## 개요

PDF에서 변환된 IBK 내규 마크다운 파일을 재사용 가능한 형태로 정리합니다.
법률문서 특화 클리닝 로직으로 일반 md-cleaner와 차별화됩니다.

## 핵심 기능

| 기능 | 설명 |
|------|------|
| 제/개정 이력 간소화 | 테이블 전체 → `YYYY.MM.DD(제XX차 개정)` 한 줄 |
| 잘못된 헤더 제거 | 유효 헤더만 유지 (제X장, 제X절, 부칙) |
| 조문 구조 인식 | 제X조, ①②③, 1. 2. 3., (가)(나) |
| 문장 연결 | 불완전 문장 자동 연결 (빈 줄 넘어서도) |
| 리스트 마커 정리 | 조문 앞 `-` 제거, 호번호 리스트는 유지 |
| 호번호 서식 수정 | 마침표 누락·숫자 공백·항목 사이 빈 줄 자동 수정 |

## 사용법

### 단일 파일 처리

```bash
python .claude/skills/clean-ibk-regulation/scripts/clean_regulation.py "인사규정.md"
```

### 배치 처리

```bash
python .claude/skills/clean-ibk-regulation/scripts/clean_regulation.py --batch "sources/internal_regulations/"
```

### 출력 폴더 지정

```bash
python .claude/skills/clean-ibk-regulation/scripts/clean_regulation.py --batch "sources/" --output "notes/"
```

### 수동 개정일 지정

제/개정 테이블이 없는 파일의 경우:

```bash
python .claude/skills/clean-ibk-regulation/scripts/clean_regulation.py "업무분장규정.md" --revision "2025.7.15(제83차 개정)"
```

### 미리보기 (Dry-run)

```bash
python .claude/skills/clean-ibk-regulation/scripts/clean_regulation.py --batch "sources/" --dry-run
```

## CLI 옵션

| 옵션 | 단축 | 설명 |
|------|------|------|
| `--batch DIR` | `-b` | 디렉토리 내 모든 .md 처리 |
| `--output DIR` | `-o` | 출력 폴더 지정 (기본: 입력과 동일) |
| `--revision STR` | `-r` | 수동 개정일 지정 |
| `--dry-run` | `-n` | 미리보기 (파일 생성 안 함) |
| `--verbose` | `-v` | 상세 로그 출력 |

## 수동 개정일 파일

`data/manual_revisions.json`에 테이블이 없는 파일의 개정일을 미리 등록할 수 있습니다:

```json
{
  "업무분장규정": "2025.7.15(제83차 개정)"
}
```

파일명(확장자 제외) 기준으로 매칭됩니다.

## 클리닝 규칙 상세

### 1. 제/개정 이력 처리

**입력:**
```markdown
| 제정 및 개정 | 결재 |
|---|---|
| 1990. 1.15. 제정 | |
| 2024. 7.15. 제72차 개정 | |
```

**출력:**
```markdown
# 인사규정
2024.7.15(제72차 개정)
```

### 2. 유효 헤더 판별

유효 헤더 (유지됨):
- `# 제1장 총칙` → `## 제1장 총칙`
- `# 제1절 목적` → `## 제1절 목적`
- `# 부칙` → `## 부칙`
- `# [별표1]` → `## [별표1]`

무효 헤더 (제거됨):
- `# 인사규정` (페이지 반복)
- `# 2025.7.15` (날짜만)
- `# 제XX차 개정` (개정 정보만)

### 3. 조문 구조

```markdown
제1조(목적) 이 규정은 ...
① 직원의 인사에 관한 ...
② 제1항에도 불구하고 ...
1. 정규직
2. 계약직
(가) 신규 채용
(나) 전환 채용
```

### 4. 문장 연결

**입력:**
```markdown
제7조 제1항의 기준에

따라 시행한다.
```

**출력:**
```markdown
제7조 제1항의 기준에 따라 시행한다.
```

## 대상 파일

### R-about_ibk/sources/internal_regulations/
- 인사규정, 보수규정, 복무규정, 복지규정, 휴가규정
- 퇴직금규정, 성과연봉제규정, 임원연봉규정, 임금피크제 보수규정
- 인사위원회규정, 종합근무평정규정, 종합근무평정 운용기준

### 기타
- `sources/업무분장규정.md` - 수동 개정일 필요

## 출력

- 출력 파일명: `{원본파일명}_clean.md`
- 기본 위치: 입력 파일과 동일 디렉토리
- `--output` 옵션으로 별도 디렉토리 지정 가능

## 의존성

- Python 3.8+
- 표준 라이브러리만 사용 (외부 패키지 불필요)

## vs md-cleaner

| 항목 | md-cleaner | clean-ibk-regulation |
|------|------------|---------------------|
| 대상 | 범용 마크다운 | IBK 내규 특화 |
| 테이블 처리 | 보존 | 제/개정 이력 → 한 줄 요약 |
| 헤더 판별 | 전체 유지 | 유효 헤더만 유지 |
| 조문 구조 | 미지원 | 제X조/항/호 인식 |
| 문장 연결 | 기본 | 법률문서 패턴 특화 |

## 제한사항

- **PDF 품질 의존**: 원본 PDF 변환 품질에 따라 결과가 달라질 수 있음
- **복잡한 표**: 제/개정 이력 외의 복잡한 표는 그대로 유지됨
- **이미지/도표**: 텍스트만 처리, 이미지/도표 참조는 그대로 유지
- **매우 긴 조문**: 20개 이상의 항(①~⑳)까지 지원

## 트러블슈팅

### 문장이 제대로 연결되지 않음
- 불완전 문장 패턴이 누락되었을 수 있음
- `--verbose` 옵션으로 처리 과정 확인
- 필요시 `is_incomplete_ending()` 또는 `is_continuation_fragment()` 패턴 추가

### 인코딩 오류
- UTF-8, CP949, EUC-KR, UTF-8-BOM 순으로 자동 시도
- 그래도 실패하면 원본 파일 인코딩 확인 필요

### 개정일이 추출되지 않음
- 테이블 형식이 예상과 다를 수 있음
- `--revision` 옵션으로 수동 지정
- 또는 `data/manual_revisions.json`에 등록

## 변경 이력

### v1.3.0 (2026-01-23)
- 호번호 마침표 누락 자동 수정: `9 타부서` → `9. 타부서`
- 숫자 사이 공백 자동 수정: `1 1 정부` → `11. 정부`
- 호번호 항목 사이 불필요한 빈 줄 자동 제거

### v1.2.0 (2026-01-23)
- 호번호(1. 2. 3.) 리스트 마커 제거 → 일관된 `숫자.` 형식으로 통일

### v1.1.0 (2026-01-22)
- 항번호 범위 확장 (①~⑮ → ①~⑳)
- 조문 번호 공백 제거 일반화 (제X조, 제X항, 제X호, 제X장, 제X절)
- 불완전 문장/연결 조각 패턴 추가
- 인코딩 폴백 추가 (UTF-8 → CP949 → EUC-KR → UTF-8-BOM)
- `--version` 옵션 추가

### v1.0.0 (2026-01-22)
- 초기 릴리스
- 제/개정 이력 테이블 간소화
- 조문 구조 인식
- 불완전 문장 자동 연결
